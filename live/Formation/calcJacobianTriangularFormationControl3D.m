%% Calculating the direct and inverse Jacobian matrix

% This code calculates the Jacobian matrix from the relationships between 
% the robot variables and the formation variables. Taking the first time
% derivative of the forward and the inverse kinematics transformations we
% can obtain the relationship between the dX and dQ, represented by the
% Jacobian matrix, which is given by dQ = J(X)dX in the forward way, and by
% dX = J^-1(Q)dQ in the inverse way, where J(X) = dQ_nx1 / dX_mx1 and the 
% inverse Jacobian is J^-1(Q) = dX_mx1 / dQ_nx1, for m,n = 1,2,...,9.

%% Initial commands
close all; 
clearvars; 
clc;
syms x1 y1 z1    x2 y2 z2    x3 y3 z3    real

%% Jacobian Matrix J(X)
% Definign equations in the direct way ( X --->> Q )

% Position (P)
xF = (x1 + x2 + x3)/3;
yF = (y1 + y2 + y3)/3;
zF = (z1 + z2 + z3)/3;

% Shape (S)
p = sqrt((x1 - x2)^2 + (y1-y2)^2 + (z1-z2)^2);
q = sqrt((x1 - x3)^2 + (y1-y3)^2 + (z1-z3)^2);
r = sqrt((x2 - x3)^2 + (y2-y3)^2 + (z2-z3)^2);
beta = acos((p^2 + q^2 + r^2)/(2*p*q));

% Orientation (O)
phi = atan2((2*y1 - y2 - y3),(2*z1 - z2 - z3));
theta = -atan2((2*x1 - x2 - x3),(2*z1 - z2 - z3));
psi = atan2((2*x1 - x2 - x3),(2*y1 - y2 - y3));

J = jacobian...
    ([  xF   yF   zF         p   q   beta          phi  theta   psi  ],...
     [  x1   y1   z1         x2  y2  z2            x3     y3    z3   ]);
            
J = simplify(J);

%% Inverse Jacobian Matrix J^-1(Q)
% Definign equations in the inverse way ( Q --->> X )

% Clearing unnecessary variables and defining new ones
clearvars -except J; 
syms xF yF zF    p q  beta    phi theta psi    real

% Auxiliary parameters
r = sqrt(p^2 + q^2 - 2*p*q*cos(beta));
h1 = sqrt(0.5*(p^2 + q^2 - 0.5*r^2));
h2 = sqrt(0.5*(r^2 + p^2 - 0.5*q^2));
h3 = sqrt(0.5*(q^2 + r^2 - 0.5*p^2));
alpha1 = acos((4*(h1^2 + h2^2) - 9*p^2)/(8*h1*h2));
alpha2 = acos((4*(h1^2 + h3^2) - 9*q^2)/(8*h1*h3));

% Robot 1 (R1)
x1 = 2/3*h1*cos(theta)*cos(psi) + xF;
y1 = 2/3*h1*cos(theta)*sin(psi) + yF;
z1 = - 2/3*h1*sin(theta) + zF;

% Robot 2 (R2)
x2 =  2/3*h2*cos(alpha1)*cos(theta)*cos(psi) ...
    + 2/3*h2*sin(alpha1)*(sin(phi)*sin(theta)*cos(psi) - cos(phi)*sin(psi)) ...
    + xF;
y2 =  2/3*h2*cos(alpha1)*cos(theta)*sin(psi) ...
    + 2/3*h2*sin(alpha1)*(sin(phi)*sin(theta)*sin(psi) + cos(phi)*cos(psi)) ...
    + yF;
z2 = - 2/3*h2*cos(alpha1)*sin(theta) ...
    + 2/3*h2*sin(alpha1)*sin(phi)*cos(theta)...
    + zF;

% Robot 3 (R3)
x3 =  2/3*h3*cos(alpha2)*cos(theta)*cos(psi) ...
    - 2/3*h3*sin(alpha2)*(sin(phi)*sin(theta)*cos(psi) - cos(phi)*sin(psi)) ...
    + xF;
y3 =   2/3*h3*cos(alpha2)*cos(theta)*sin(psi) ...
    - 2/3*h3*sin(alpha2)*(sin(phi)*sin(theta)*sin(psi) + cos(phi)*cos(psi)) ...
    + yF;
z3 = - 2/3*h3*cos(alpha2)*sin(theta) ...
    - 2/3*h3*sin(alpha2)*sin(phi)*cos(theta)...
    + zF;

Jinv = jacobian...
    ([  x1   y1   z1         x2  y2  z2            x3     y3    z3   ],...
     [  xF   yF   zF         p   q   beta          phi  theta   psi  ]);
            
Jinv = simplify(Jinv);

clearvars -except   J    Jinv; 

%% Printing in Command Window the results

% Jacobian
clc;
fprintf('___________________________________________________________________________________\n');
fprintf('\n                           Jacobian Matrix   | J(X) | \n');
fprintf('___________________________________________________________________________________\n\n');


for i = 1:size(J,1)
    fprintf(['\n\n _______________________  Line ' num2str(i) ':  _______________________\n\n']);
    for j = 1:size(J,1)
        fprintf(['\n [' num2str(j) '] ---> J(' num2str(i) ',' num2str(j) '):  ']);
        disp(J(i,j));
    end
    fprintf('__________________________________________________________\n\n');
end

% Inverse Jacobian
fprintf('__________________________________________________________\n');
fprintf('\n         Inverse Jacobian Matrix   | J^-1(Q) | \n');
fprintf('__________________________________________________________\n');
for i = 1:size(Jinv,1)
    fprintf(['\n\n _______________________  Line ' num2str(i) ':  _______________________\n\n']);
    for j = 1:size(Jinv,1)
        fprintf(['\n [' num2str(j) '] ---> J^-1(' num2str(i) ',' num2str(j) '):  ']);
        disp(Jinv(i,j));
    end
    fprintf('__________________________________________________________\n\n');
end

%% Creating the Jacobian Matrix
Jaut = char([newline newline 'J = [ ']);
for i = 1:size(J,1)
    if i ~= 1
        Jaut = [ Jaut newline '        '];
    end
    for j = 1:size(J,1)
        if j ~= 9
            Jaut = [ Jaut , char(J(i,j)) ' , '];
        elseif j == 9 && i == 4
            Jaut = [ Jaut , char(J(i,j)) ''];
        else
            Jaut = [ Jaut , char(J(i,j)) ' ; '];
        end
    end
end
Jaut = [ Jaut ' ];' newline newline];

%% Test Jacobian Matrix
% Random values
x1 = random('Normal',0,3);
y1 = random('Normal',0,3);
z1 = random('Normal',0,3);

x2 = random('Normal',0,3);
y2 = random('Normal',0,3); 
z2 = random('Normal',0,3);

x3 = random('Normal',0,3);
y3 = random('Normal',0,3);
z3 = random('Normal',0,3);

fprintf('\n\n___________________________________________________________________________________\n\n');
fprintf('                                      FINAL RESULTS                                    ');
fprintf('\n___________________________________________________________________________________\n\n');


fprintf('\n\n(i) Jacobian Matrix obtained: \n\n');
fprintf('J = ');
disp(J);
fprintf('        - Copy this equation and paste inside the code: J = [];');
fprintf('\n\n        - Do the necessary changes.\n\n');

fprintf('___________________________________________________________________________________\n\n');

fprintf('\n(ii) Jacobian Matrix with the correct syntax to Matlab code');
disp(Jaut);
fprintf('          - Copy this equation and paste inside the code: Jsynt = [];\n');
fprintf('\n          - No changes are necessary, just copy and paste.');
fprintf('\n\n          ---> Then run the rest of the code.\n\n');

fprintf('___________________________________________________________________________________\n\n');

fprintf('\n          ... Applying random values in robots variables:  X = [ x1 y1 z1 ... x3 y3 z3 ];\n');


%% Change this
% J_begin
J = [                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             1/3,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                0,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                0,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          1/3,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            0,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            0,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          1/3,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            0,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            0;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    0,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              1/3,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                0,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            0,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          1/3,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            0,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            0,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          1/3,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            0;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    0,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                0,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              1/3,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            0,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            0,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          1/3,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            0,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            0,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          1/3;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            (x1 - x2)/((x1 - x2)^2 + (y1 - y2)^2 + (z1 - z2)^2)^(1/2),                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        (y1 - y2)/((x1 - x2)^2 + (y1 - y2)^2 + (z1 - z2)^2)^(1/2),                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        (z1 - z2)/((x1 - x2)^2 + (y1 - y2)^2 + (z1 - z2)^2)^(1/2),                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   -(x1 - x2)/((x1 - x2)^2 + (y1 - y2)^2 + (z1 - z2)^2)^(1/2),                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   -(y1 - y2)/((x1 - x2)^2 + (y1 - y2)^2 + (z1 - z2)^2)^(1/2),                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   -(z1 - z2)/((x1 - x2)^2 + (y1 - y2)^2 + (z1 - z2)^2)^(1/2),                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            0,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            0,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            0;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            (x1 - x3)/((x1 - x3)^2 + (y1 - y3)^2 + (z1 - z3)^2)^(1/2),                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        (y1 - y3)/((x1 - x3)^2 + (y1 - y3)^2 + (z1 - z3)^2)^(1/2),                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        (z1 - z3)/((x1 - x3)^2 + (y1 - y3)^2 + (z1 - z3)^2)^(1/2),                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            0,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            0,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            0,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   -(x1 - x3)/((x1 - x3)^2 + (y1 - y3)^2 + (z1 - z3)^2)^(1/2),                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   -(y1 - y3)/((x1 - x3)^2 + (y1 - y3)^2 + (z1 - z3)^2)^(1/2),                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   -(z1 - z3)/((x1 - x3)^2 + (y1 - y3)^2 + (z1 - z3)^2)^(1/2);
     ((x2 - 2*x1 + x3)/(((x1 - x2)^2 + (y1 - y2)^2 + (z1 - z2)^2)^(1/2)*((x1 - x3)^2 + (y1 - y3)^2 + (z1 - z3)^2)^(1/2)) + ((2*x1 - 2*x2)*((x1 - x2)^2 + (x1 - x3)^2 + (x2 - x3)^2 + (y1 - y2)^2 + (y1 - y3)^2 + (y2 - y3)^2 + (z1 - z2)^2 + (z1 - z3)^2 + (z2 - z3)^2))/(4*((x1 - x2)^2 + (y1 - y2)^2 + (z1 - z2)^2)^(3/2)*((x1 - x3)^2 + (y1 - y3)^2 + (z1 - z3)^2)^(1/2)) + ((2*x1 - 2*x3)*((x1 - x2)^2 + (x1 - x3)^2 + (x2 - x3)^2 + (y1 - y2)^2 + (y1 - y3)^2 + (y2 - y3)^2 + (z1 - z2)^2 + (z1 - z3)^2 + (z2 - z3)^2))/(4*((x1 - x2)^2 + (y1 - y2)^2 + (z1 - z2)^2)^(1/2)*((x1 - x3)^2 + (y1 - y3)^2 + (z1 - z3)^2)^(3/2)))/(1 - ((x1 - x2)^2 + (x1 - x3)^2 + (x2 - x3)^2 + (y1 - y2)^2 + (y1 - y3)^2 + (y2 - y3)^2 + (z1 - z2)^2 + (z1 - z3)^2 + (z2 - z3)^2)^2/(4*((x1 - x2)^2 + (y1 - y2)^2 + (z1 - z2)^2)*((x1 - x3)^2 + (y1 - y3)^2 + (z1 - z3)^2)))^(1/2), ((y2 - 2*y1 + y3)/(((x1 - x2)^2 + (y1 - y2)^2 + (z1 - z2)^2)^(1/2)*((x1 - x3)^2 + (y1 - y3)^2 + (z1 - z3)^2)^(1/2)) + ((2*y1 - 2*y2)*((x1 - x2)^2 + (x1 - x3)^2 + (x2 - x3)^2 + (y1 - y2)^2 + (y1 - y3)^2 + (y2 - y3)^2 + (z1 - z2)^2 + (z1 - z3)^2 + (z2 - z3)^2))/(4*((x1 - x2)^2 + (y1 - y2)^2 + (z1 - z2)^2)^(3/2)*((x1 - x3)^2 + (y1 - y3)^2 + (z1 - z3)^2)^(1/2)) + ((2*y1 - 2*y3)*((x1 - x2)^2 + (x1 - x3)^2 + (x2 - x3)^2 + (y1 - y2)^2 + (y1 - y3)^2 + (y2 - y3)^2 + (z1 - z2)^2 + (z1 - z3)^2 + (z2 - z3)^2))/(4*((x1 - x2)^2 + (y1 - y2)^2 + (z1 - z2)^2)^(1/2)*((x1 - x3)^2 + (y1 - y3)^2 + (z1 - z3)^2)^(3/2)))/(1 - ((x1 - x2)^2 + (x1 - x3)^2 + (x2 - x3)^2 + (y1 - y2)^2 + (y1 - y3)^2 + (y2 - y3)^2 + (z1 - z2)^2 + (z1 - z3)^2 + (z2 - z3)^2)^2/(4*((x1 - x2)^2 + (y1 - y2)^2 + (z1 - z2)^2)*((x1 - x3)^2 + (y1 - y3)^2 + (z1 - z3)^2)))^(1/2), ((z2 - 2*z1 + z3)/(((x1 - x2)^2 + (y1 - y2)^2 + (z1 - z2)^2)^(1/2)*((x1 - x3)^2 + (y1 - y3)^2 + (z1 - z3)^2)^(1/2)) + ((2*z1 - 2*z2)*((x1 - x2)^2 + (x1 - x3)^2 + (x2 - x3)^2 + (y1 - y2)^2 + (y1 - y3)^2 + (y2 - y3)^2 + (z1 - z2)^2 + (z1 - z3)^2 + (z2 - z3)^2))/(4*((x1 - x2)^2 + (y1 - y2)^2 + (z1 - z2)^2)^(3/2)*((x1 - x3)^2 + (y1 - y3)^2 + (z1 - z3)^2)^(1/2)) + ((2*z1 - 2*z3)*((x1 - x2)^2 + (x1 - x3)^2 + (x2 - x3)^2 + (y1 - y2)^2 + (y1 - y3)^2 + (y2 - y3)^2 + (z1 - z2)^2 + (z1 - z3)^2 + (z2 - z3)^2))/(4*((x1 - x2)^2 + (y1 - y2)^2 + (z1 - z2)^2)^(1/2)*((x1 - x3)^2 + (y1 - y3)^2 + (z1 - z3)^2)^(3/2)))/(1 - ((x1 - x2)^2 + (x1 - x3)^2 + (x2 - x3)^2 + (y1 - y2)^2 + (y1 - y3)^2 + (y2 - y3)^2 + (z1 - z2)^2 + (z1 - z3)^2 + (z2 - z3)^2)^2/(4*((x1 - x2)^2 + (y1 - y2)^2 + (z1 - z2)^2)*((x1 - x3)^2 + (y1 - y3)^2 + (z1 - z3)^2)))^(1/2), ((x1 - 2*x2 + x3)/(((x1 - x2)^2 + (y1 - y2)^2 + (z1 - z2)^2)^(1/2)*((x1 - x3)^2 + (y1 - y3)^2 + (z1 - z3)^2)^(1/2)) - ((2*x1 - 2*x2)*((x1 - x2)^2 + (x1 - x3)^2 + (x2 - x3)^2 + (y1 - y2)^2 + (y1 - y3)^2 + (y2 - y3)^2 + (z1 - z2)^2 + (z1 - z3)^2 + (z2 - z3)^2))/(4*((x1 - x2)^2 + (y1 - y2)^2 + (z1 - z2)^2)^(3/2)*((x1 - x3)^2 + (y1 - y3)^2 + (z1 - z3)^2)^(1/2)))/(1 - ((x1 - x2)^2 + (x1 - x3)^2 + (x2 - x3)^2 + (y1 - y2)^2 + (y1 - y3)^2 + (y2 - y3)^2 + (z1 - z2)^2 + (z1 - z3)^2 + (z2 - z3)^2)^2/(4*((x1 - x2)^2 + (y1 - y2)^2 + (z1 - z2)^2)*((x1 - x3)^2 + (y1 - y3)^2 + (z1 - z3)^2)))^(1/2), ((y1 - 2*y2 + y3)/(((x1 - x2)^2 + (y1 - y2)^2 + (z1 - z2)^2)^(1/2)*((x1 - x3)^2 + (y1 - y3)^2 + (z1 - z3)^2)^(1/2)) - ((2*y1 - 2*y2)*((x1 - x2)^2 + (x1 - x3)^2 + (x2 - x3)^2 + (y1 - y2)^2 + (y1 - y3)^2 + (y2 - y3)^2 + (z1 - z2)^2 + (z1 - z3)^2 + (z2 - z3)^2))/(4*((x1 - x2)^2 + (y1 - y2)^2 + (z1 - z2)^2)^(3/2)*((x1 - x3)^2 + (y1 - y3)^2 + (z1 - z3)^2)^(1/2)))/(1 - ((x1 - x2)^2 + (x1 - x3)^2 + (x2 - x3)^2 + (y1 - y2)^2 + (y1 - y3)^2 + (y2 - y3)^2 + (z1 - z2)^2 + (z1 - z3)^2 + (z2 - z3)^2)^2/(4*((x1 - x2)^2 + (y1 - y2)^2 + (z1 - z2)^2)*((x1 - x3)^2 + (y1 - y3)^2 + (z1 - z3)^2)))^(1/2), ((z1 - 2*z2 + z3)/(((x1 - x2)^2 + (y1 - y2)^2 + (z1 - z2)^2)^(1/2)*((x1 - x3)^2 + (y1 - y3)^2 + (z1 - z3)^2)^(1/2)) - ((2*z1 - 2*z2)*((x1 - x2)^2 + (x1 - x3)^2 + (x2 - x3)^2 + (y1 - y2)^2 + (y1 - y3)^2 + (y2 - y3)^2 + (z1 - z2)^2 + (z1 - z3)^2 + (z2 - z3)^2))/(4*((x1 - x2)^2 + (y1 - y2)^2 + (z1 - z2)^2)^(3/2)*((x1 - x3)^2 + (y1 - y3)^2 + (z1 - z3)^2)^(1/2)))/(1 - ((x1 - x2)^2 + (x1 - x3)^2 + (x2 - x3)^2 + (y1 - y2)^2 + (y1 - y3)^2 + (y2 - y3)^2 + (z1 - z2)^2 + (z1 - z3)^2 + (z2 - z3)^2)^2/(4*((x1 - x2)^2 + (y1 - y2)^2 + (z1 - z2)^2)*((x1 - x3)^2 + (y1 - y3)^2 + (z1 - z3)^2)))^(1/2), ((x1 + x2 - 2*x3)/(((x1 - x2)^2 + (y1 - y2)^2 + (z1 - z2)^2)^(1/2)*((x1 - x3)^2 + (y1 - y3)^2 + (z1 - z3)^2)^(1/2)) - ((2*x1 - 2*x3)*((x1 - x2)^2 + (x1 - x3)^2 + (x2 - x3)^2 + (y1 - y2)^2 + (y1 - y3)^2 + (y2 - y3)^2 + (z1 - z2)^2 + (z1 - z3)^2 + (z2 - z3)^2))/(4*((x1 - x2)^2 + (y1 - y2)^2 + (z1 - z2)^2)^(1/2)*((x1 - x3)^2 + (y1 - y3)^2 + (z1 - z3)^2)^(3/2)))/(1 - ((x1 - x2)^2 + (x1 - x3)^2 + (x2 - x3)^2 + (y1 - y2)^2 + (y1 - y3)^2 + (y2 - y3)^2 + (z1 - z2)^2 + (z1 - z3)^2 + (z2 - z3)^2)^2/(4*((x1 - x2)^2 + (y1 - y2)^2 + (z1 - z2)^2)*((x1 - x3)^2 + (y1 - y3)^2 + (z1 - z3)^2)))^(1/2), ((y1 + y2 - 2*y3)/(((x1 - x2)^2 + (y1 - y2)^2 + (z1 - z2)^2)^(1/2)*((x1 - x3)^2 + (y1 - y3)^2 + (z1 - z3)^2)^(1/2)) - ((2*y1 - 2*y3)*((x1 - x2)^2 + (x1 - x3)^2 + (x2 - x3)^2 + (y1 - y2)^2 + (y1 - y3)^2 + (y2 - y3)^2 + (z1 - z2)^2 + (z1 - z3)^2 + (z2 - z3)^2))/(4*((x1 - x2)^2 + (y1 - y2)^2 + (z1 - z2)^2)^(1/2)*((x1 - x3)^2 + (y1 - y3)^2 + (z1 - z3)^2)^(3/2)))/(1 - ((x1 - x2)^2 + (x1 - x3)^2 + (x2 - x3)^2 + (y1 - y2)^2 + (y1 - y3)^2 + (y2 - y3)^2 + (z1 - z2)^2 + (z1 - z3)^2 + (z2 - z3)^2)^2/(4*((x1 - x2)^2 + (y1 - y2)^2 + (z1 - z2)^2)*((x1 - x3)^2 + (y1 - y3)^2 + (z1 - z3)^2)))^(1/2), ((z1 + z2 - 2*z3)/(((x1 - x2)^2 + (y1 - y2)^2 + (z1 - z2)^2)^(1/2)*((x1 - x3)^2 + (y1 - y3)^2 + (z1 - z3)^2)^(1/2)) - ((2*z1 - 2*z3)*((x1 - x2)^2 + (x1 - x3)^2 + (x2 - x3)^2 + (y1 - y2)^2 + (y1 - y3)^2 + (y2 - y3)^2 + (z1 - z2)^2 + (z1 - z3)^2 + (z2 - z3)^2))/(4*((x1 - x2)^2 + (y1 - y2)^2 + (z1 - z2)^2)^(1/2)*((x1 - x3)^2 + (y1 - y3)^2 + (z1 - z3)^2)^(3/2)))/(1 - ((x1 - x2)^2 + (x1 - x3)^2 + (x2 - x3)^2 + (y1 - y2)^2 + (y1 - y3)^2 + (y2 - y3)^2 + (z1 - z2)^2 + (z1 - z3)^2 + (z2 - z3)^2)^2/(4*((x1 - x2)^2 + (y1 - y2)^2 + (z1 - z2)^2)*((x1 - x3)^2 + (y1 - y3)^2 + (z1 - z3)^2)))^(1/2);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    0,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  -(2*z2 - 4*z1 + 2*z3)/((y2 - 2*y1 + y3)^2 + (z2 - 2*z1 + z3)^2),                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   (2*y2 - 4*y1 + 2*y3)/((y2 - 2*y1 + y3)^2 + (z2 - 2*z1 + z3)^2),                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            0,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   (z2 - 2*z1 + z3)/((y2 - 2*y1 + y3)^2 + (z2 - 2*z1 + z3)^2),                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  -(y2 - 2*y1 + y3)/((y2 - 2*y1 + y3)^2 + (z2 - 2*z1 + z3)^2),                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            0,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   (z2 - 2*z1 + z3)/((y2 - 2*y1 + y3)^2 + (z2 - 2*z1 + z3)^2),                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  -(y2 - 2*y1 + y3)/((y2 - 2*y1 + y3)^2 + (z2 - 2*z1 + z3)^2);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       (2*z2 - 4*z1 + 2*z3)/((x2 - 2*x1 + x3)^2 + (z2 - 2*z1 + z3)^2),                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                0,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  -(2*x2 - 4*x1 + 2*x3)/((x2 - 2*x1 + x3)^2 + (z2 - 2*z1 + z3)^2),                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  -(z2 - 2*z1 + z3)/((x2 - 2*x1 + x3)^2 + (z2 - 2*z1 + z3)^2),                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            0,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   (x2 - 2*x1 + x3)/((x2 - 2*x1 + x3)^2 + (z2 - 2*z1 + z3)^2),                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  -(z2 - 2*z1 + z3)/((x2 - 2*x1 + x3)^2 + (z2 - 2*z1 + z3)^2),                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            0,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   (x2 - 2*x1 + x3)/((x2 - 2*x1 + x3)^2 + (z2 - 2*z1 + z3)^2);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      -(2*y2 - 4*y1 + 2*y3)/((x2 - 2*x1 + x3)^2 + (y2 - 2*y1 + y3)^2),                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   (2*x2 - 4*x1 + 2*x3)/((x2 - 2*x1 + x3)^2 + (y2 - 2*y1 + y3)^2),                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                0,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   (y2 - 2*y1 + y3)/((x2 - 2*x1 + x3)^2 + (y2 - 2*y1 + y3)^2),                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  -(x2 - 2*x1 + x3)/((x2 - 2*x1 + x3)^2 + (y2 - 2*y1 + y3)^2),                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            0,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   (y2 - 2*y1 + y3)/((x2 - 2*x1 + x3)^2 + (y2 - 2*y1 + y3)^2),                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  -(x2 - 2*x1 + x3)/((x2 - 2*x1 + x3)^2 + (y2 - 2*y1 + y3)^2),                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            0];
% J_end

% Jaut_begin
Jaut = [ 1/3 , 0 , 0 , 1/3 , 0 , 0 , 1/3 , 0 , 0 ; 
        0 , 1/3 , 0 , 0 , 1/3 , 0 , 0 , 1/3 , 0 ; 
        0 , 0 , 1/3 , 0 , 0 , 1/3 , 0 , 0 , 1/3 ; 
        (x1 - x2)/((x1 - x2)^2 + (y1 - y2)^2 + (z1 - z2)^2)^(1/2) , (y1 - y2)/((x1 - x2)^2 + (y1 - y2)^2 + (z1 - z2)^2)^(1/2) , (z1 - z2)/((x1 - x2)^2 + (y1 - y2)^2 + (z1 - z2)^2)^(1/2) , -(x1 - x2)/((x1 - x2)^2 + (y1 - y2)^2 + (z1 - z2)^2)^(1/2) , -(y1 - y2)/((x1 - x2)^2 + (y1 - y2)^2 + (z1 - z2)^2)^(1/2) , -(z1 - z2)/((x1 - x2)^2 + (y1 - y2)^2 + (z1 - z2)^2)^(1/2) , 0 , 0 , 0
        (x1 - x3)/((x1 - x3)^2 + (y1 - y3)^2 + (z1 - z3)^2)^(1/2) , (y1 - y3)/((x1 - x3)^2 + (y1 - y3)^2 + (z1 - z3)^2)^(1/2) , (z1 - z3)/((x1 - x3)^2 + (y1 - y3)^2 + (z1 - z3)^2)^(1/2) , 0 , 0 , 0 , -(x1 - x3)/((x1 - x3)^2 + (y1 - y3)^2 + (z1 - z3)^2)^(1/2) , -(y1 - y3)/((x1 - x3)^2 + (y1 - y3)^2 + (z1 - z3)^2)^(1/2) , -(z1 - z3)/((x1 - x3)^2 + (y1 - y3)^2 + (z1 - z3)^2)^(1/2) ; 
        ((x2 - 2*x1 + x3)/(((x1 - x2)^2 + (y1 - y2)^2 + (z1 - z2)^2)^(1/2)*((x1 - x3)^2 + (y1 - y3)^2 + (z1 - z3)^2)^(1/2)) + ((2*x1 - 2*x2)*((x1 - x2)^2 + (x1 - x3)^2 + (x2 - x3)^2 + (y1 - y2)^2 + (y1 - y3)^2 + (y2 - y3)^2 + (z1 - z2)^2 + (z1 - z3)^2 + (z2 - z3)^2))/(4*((x1 - x2)^2 + (y1 - y2)^2 + (z1 - z2)^2)^(3/2)*((x1 - x3)^2 + (y1 - y3)^2 + (z1 - z3)^2)^(1/2)) + ((2*x1 - 2*x3)*((x1 - x2)^2 + (x1 - x3)^2 + (x2 - x3)^2 + (y1 - y2)^2 + (y1 - y3)^2 + (y2 - y3)^2 + (z1 - z2)^2 + (z1 - z3)^2 + (z2 - z3)^2))/(4*((x1 - x2)^2 + (y1 - y2)^2 + (z1 - z2)^2)^(1/2)*((x1 - x3)^2 + (y1 - y3)^2 + (z1 - z3)^2)^(3/2)))/(1 - ((x1 - x2)^2 + (x1 - x3)^2 + (x2 - x3)^2 + (y1 - y2)^2 + (y1 - y3)^2 + (y2 - y3)^2 + (z1 - z2)^2 + (z1 - z3)^2 + (z2 - z3)^2)^2/(4*((x1 - x2)^2 + (y1 - y2)^2 + (z1 - z2)^2)*((x1 - x3)^2 + (y1 - y3)^2 + (z1 - z3)^2)))^(1/2) , ((y2 - 2*y1 + y3)/(((x1 - x2)^2 + (y1 - y2)^2 + (z1 - z2)^2)^(1/2)*((x1 - x3)^2 + (y1 - y3)^2 + (z1 - z3)^2)^(1/2)) + ((2*y1 - 2*y2)*((x1 - x2)^2 + (x1 - x3)^2 + (x2 - x3)^2 + (y1 - y2)^2 + (y1 - y3)^2 + (y2 - y3)^2 + (z1 - z2)^2 + (z1 - z3)^2 + (z2 - z3)^2))/(4*((x1 - x2)^2 + (y1 - y2)^2 + (z1 - z2)^2)^(3/2)*((x1 - x3)^2 + (y1 - y3)^2 + (z1 - z3)^2)^(1/2)) + ((2*y1 - 2*y3)*((x1 - x2)^2 + (x1 - x3)^2 + (x2 - x3)^2 + (y1 - y2)^2 + (y1 - y3)^2 + (y2 - y3)^2 + (z1 - z2)^2 + (z1 - z3)^2 + (z2 - z3)^2))/(4*((x1 - x2)^2 + (y1 - y2)^2 + (z1 - z2)^2)^(1/2)*((x1 - x3)^2 + (y1 - y3)^2 + (z1 - z3)^2)^(3/2)))/(1 - ((x1 - x2)^2 + (x1 - x3)^2 + (x2 - x3)^2 + (y1 - y2)^2 + (y1 - y3)^2 + (y2 - y3)^2 + (z1 - z2)^2 + (z1 - z3)^2 + (z2 - z3)^2)^2/(4*((x1 - x2)^2 + (y1 - y2)^2 + (z1 - z2)^2)*((x1 - x3)^2 + (y1 - y3)^2 + (z1 - z3)^2)))^(1/2) , ((z2 - 2*z1 + z3)/(((x1 - x2)^2 + (y1 - y2)^2 + (z1 - z2)^2)^(1/2)*((x1 - x3)^2 + (y1 - y3)^2 + (z1 - z3)^2)^(1/2)) + ((2*z1 - 2*z2)*((x1 - x2)^2 + (x1 - x3)^2 + (x2 - x3)^2 + (y1 - y2)^2 + (y1 - y3)^2 + (y2 - y3)^2 + (z1 - z2)^2 + (z1 - z3)^2 + (z2 - z3)^2))/(4*((x1 - x2)^2 + (y1 - y2)^2 + (z1 - z2)^2)^(3/2)*((x1 - x3)^2 + (y1 - y3)^2 + (z1 - z3)^2)^(1/2)) + ((2*z1 - 2*z3)*((x1 - x2)^2 + (x1 - x3)^2 + (x2 - x3)^2 + (y1 - y2)^2 + (y1 - y3)^2 + (y2 - y3)^2 + (z1 - z2)^2 + (z1 - z3)^2 + (z2 - z3)^2))/(4*((x1 - x2)^2 + (y1 - y2)^2 + (z1 - z2)^2)^(1/2)*((x1 - x3)^2 + (y1 - y3)^2 + (z1 - z3)^2)^(3/2)))/(1 - ((x1 - x2)^2 + (x1 - x3)^2 + (x2 - x3)^2 + (y1 - y2)^2 + (y1 - y3)^2 + (y2 - y3)^2 + (z1 - z2)^2 + (z1 - z3)^2 + (z2 - z3)^2)^2/(4*((x1 - x2)^2 + (y1 - y2)^2 + (z1 - z2)^2)*((x1 - x3)^2 + (y1 - y3)^2 + (z1 - z3)^2)))^(1/2) , ((x1 - 2*x2 + x3)/(((x1 - x2)^2 + (y1 - y2)^2 + (z1 - z2)^2)^(1/2)*((x1 - x3)^2 + (y1 - y3)^2 + (z1 - z3)^2)^(1/2)) - ((2*x1 - 2*x2)*((x1 - x2)^2 + (x1 - x3)^2 + (x2 - x3)^2 + (y1 - y2)^2 + (y1 - y3)^2 + (y2 - y3)^2 + (z1 - z2)^2 + (z1 - z3)^2 + (z2 - z3)^2))/(4*((x1 - x2)^2 + (y1 - y2)^2 + (z1 - z2)^2)^(3/2)*((x1 - x3)^2 + (y1 - y3)^2 + (z1 - z3)^2)^(1/2)))/(1 - ((x1 - x2)^2 + (x1 - x3)^2 + (x2 - x3)^2 + (y1 - y2)^2 + (y1 - y3)^2 + (y2 - y3)^2 + (z1 - z2)^2 + (z1 - z3)^2 + (z2 - z3)^2)^2/(4*((x1 - x2)^2 + (y1 - y2)^2 + (z1 - z2)^2)*((x1 - x3)^2 + (y1 - y3)^2 + (z1 - z3)^2)))^(1/2) , ((y1 - 2*y2 + y3)/(((x1 - x2)^2 + (y1 - y2)^2 + (z1 - z2)^2)^(1/2)*((x1 - x3)^2 + (y1 - y3)^2 + (z1 - z3)^2)^(1/2)) - ((2*y1 - 2*y2)*((x1 - x2)^2 + (x1 - x3)^2 + (x2 - x3)^2 + (y1 - y2)^2 + (y1 - y3)^2 + (y2 - y3)^2 + (z1 - z2)^2 + (z1 - z3)^2 + (z2 - z3)^2))/(4*((x1 - x2)^2 + (y1 - y2)^2 + (z1 - z2)^2)^(3/2)*((x1 - x3)^2 + (y1 - y3)^2 + (z1 - z3)^2)^(1/2)))/(1 - ((x1 - x2)^2 + (x1 - x3)^2 + (x2 - x3)^2 + (y1 - y2)^2 + (y1 - y3)^2 + (y2 - y3)^2 + (z1 - z2)^2 + (z1 - z3)^2 + (z2 - z3)^2)^2/(4*((x1 - x2)^2 + (y1 - y2)^2 + (z1 - z2)^2)*((x1 - x3)^2 + (y1 - y3)^2 + (z1 - z3)^2)))^(1/2) , ((z1 - 2*z2 + z3)/(((x1 - x2)^2 + (y1 - y2)^2 + (z1 - z2)^2)^(1/2)*((x1 - x3)^2 + (y1 - y3)^2 + (z1 - z3)^2)^(1/2)) - ((2*z1 - 2*z2)*((x1 - x2)^2 + (x1 - x3)^2 + (x2 - x3)^2 + (y1 - y2)^2 + (y1 - y3)^2 + (y2 - y3)^2 + (z1 - z2)^2 + (z1 - z3)^2 + (z2 - z3)^2))/(4*((x1 - x2)^2 + (y1 - y2)^2 + (z1 - z2)^2)^(3/2)*((x1 - x3)^2 + (y1 - y3)^2 + (z1 - z3)^2)^(1/2)))/(1 - ((x1 - x2)^2 + (x1 - x3)^2 + (x2 - x3)^2 + (y1 - y2)^2 + (y1 - y3)^2 + (y2 - y3)^2 + (z1 - z2)^2 + (z1 - z3)^2 + (z2 - z3)^2)^2/(4*((x1 - x2)^2 + (y1 - y2)^2 + (z1 - z2)^2)*((x1 - x3)^2 + (y1 - y3)^2 + (z1 - z3)^2)))^(1/2) , ((x1 + x2 - 2*x3)/(((x1 - x2)^2 + (y1 - y2)^2 + (z1 - z2)^2)^(1/2)*((x1 - x3)^2 + (y1 - y3)^2 + (z1 - z3)^2)^(1/2)) - ((2*x1 - 2*x3)*((x1 - x2)^2 + (x1 - x3)^2 + (x2 - x3)^2 + (y1 - y2)^2 + (y1 - y3)^2 + (y2 - y3)^2 + (z1 - z2)^2 + (z1 - z3)^2 + (z2 - z3)^2))/(4*((x1 - x2)^2 + (y1 - y2)^2 + (z1 - z2)^2)^(1/2)*((x1 - x3)^2 + (y1 - y3)^2 + (z1 - z3)^2)^(3/2)))/(1 - ((x1 - x2)^2 + (x1 - x3)^2 + (x2 - x3)^2 + (y1 - y2)^2 + (y1 - y3)^2 + (y2 - y3)^2 + (z1 - z2)^2 + (z1 - z3)^2 + (z2 - z3)^2)^2/(4*((x1 - x2)^2 + (y1 - y2)^2 + (z1 - z2)^2)*((x1 - x3)^2 + (y1 - y3)^2 + (z1 - z3)^2)))^(1/2) , ((y1 + y2 - 2*y3)/(((x1 - x2)^2 + (y1 - y2)^2 + (z1 - z2)^2)^(1/2)*((x1 - x3)^2 + (y1 - y3)^2 + (z1 - z3)^2)^(1/2)) - ((2*y1 - 2*y3)*((x1 - x2)^2 + (x1 - x3)^2 + (x2 - x3)^2 + (y1 - y2)^2 + (y1 - y3)^2 + (y2 - y3)^2 + (z1 - z2)^2 + (z1 - z3)^2 + (z2 - z3)^2))/(4*((x1 - x2)^2 + (y1 - y2)^2 + (z1 - z2)^2)^(1/2)*((x1 - x3)^2 + (y1 - y3)^2 + (z1 - z3)^2)^(3/2)))/(1 - ((x1 - x2)^2 + (x1 - x3)^2 + (x2 - x3)^2 + (y1 - y2)^2 + (y1 - y3)^2 + (y2 - y3)^2 + (z1 - z2)^2 + (z1 - z3)^2 + (z2 - z3)^2)^2/(4*((x1 - x2)^2 + (y1 - y2)^2 + (z1 - z2)^2)*((x1 - x3)^2 + (y1 - y3)^2 + (z1 - z3)^2)))^(1/2) , ((z1 + z2 - 2*z3)/(((x1 - x2)^2 + (y1 - y2)^2 + (z1 - z2)^2)^(1/2)*((x1 - x3)^2 + (y1 - y3)^2 + (z1 - z3)^2)^(1/2)) - ((2*z1 - 2*z3)*((x1 - x2)^2 + (x1 - x3)^2 + (x2 - x3)^2 + (y1 - y2)^2 + (y1 - y3)^2 + (y2 - y3)^2 + (z1 - z2)^2 + (z1 - z3)^2 + (z2 - z3)^2))/(4*((x1 - x2)^2 + (y1 - y2)^2 + (z1 - z2)^2)^(1/2)*((x1 - x3)^2 + (y1 - y3)^2 + (z1 - z3)^2)^(3/2)))/(1 - ((x1 - x2)^2 + (x1 - x3)^2 + (x2 - x3)^2 + (y1 - y2)^2 + (y1 - y3)^2 + (y2 - y3)^2 + (z1 - z2)^2 + (z1 - z3)^2 + (z2 - z3)^2)^2/(4*((x1 - x2)^2 + (y1 - y2)^2 + (z1 - z2)^2)*((x1 - x3)^2 + (y1 - y3)^2 + (z1 - z3)^2)))^(1/2) ; 
        0 , -(2*z2 - 4*z1 + 2*z3)/((y2 - 2*y1 + y3)^2 + (z2 - 2*z1 + z3)^2) , (2*y2 - 4*y1 + 2*y3)/((y2 - 2*y1 + y3)^2 + (z2 - 2*z1 + z3)^2) , 0 , (z2 - 2*z1 + z3)/((y2 - 2*y1 + y3)^2 + (z2 - 2*z1 + z3)^2) , -(y2 - 2*y1 + y3)/((y2 - 2*y1 + y3)^2 + (z2 - 2*z1 + z3)^2) , 0 , (z2 - 2*z1 + z3)/((y2 - 2*y1 + y3)^2 + (z2 - 2*z1 + z3)^2) , -(y2 - 2*y1 + y3)/((y2 - 2*y1 + y3)^2 + (z2 - 2*z1 + z3)^2) ; 
        (2*z2 - 4*z1 + 2*z3)/((x2 - 2*x1 + x3)^2 + (z2 - 2*z1 + z3)^2) , 0 , -(2*x2 - 4*x1 + 2*x3)/((x2 - 2*x1 + x3)^2 + (z2 - 2*z1 + z3)^2) , -(z2 - 2*z1 + z3)/((x2 - 2*x1 + x3)^2 + (z2 - 2*z1 + z3)^2) , 0 , (x2 - 2*x1 + x3)/((x2 - 2*x1 + x3)^2 + (z2 - 2*z1 + z3)^2) , -(z2 - 2*z1 + z3)/((x2 - 2*x1 + x3)^2 + (z2 - 2*z1 + z3)^2) , 0 , (x2 - 2*x1 + x3)/((x2 - 2*x1 + x3)^2 + (z2 - 2*z1 + z3)^2) ; 
        -(2*y2 - 4*y1 + 2*y3)/((x2 - 2*x1 + x3)^2 + (y2 - 2*y1 + y3)^2) , (2*x2 - 4*x1 + 2*x3)/((x2 - 2*x1 + x3)^2 + (y2 - 2*y1 + y3)^2) , 0 , (y2 - 2*y1 + y3)/((x2 - 2*x1 + x3)^2 + (y2 - 2*y1 + y3)^2) , -(x2 - 2*x1 + x3)/((x2 - 2*x1 + x3)^2 + (y2 - 2*y1 + y3)^2) , 0 , (y2 - 2*y1 + y3)/((x2 - 2*x1 + x3)^2 + (y2 - 2*y1 + y3)^2) , -(x2 - 2*x1 + x3)/((x2 - 2*x1 + x3)^2 + (y2 - 2*y1 + y3)^2) , 0 ;  ];
% Jaut_end

fprintf('\n\n(iii) Jacobian Matrix with numeric values\n');
fprintf('\n\n          (J) Jacobian Matrix with manual correction after copy and paste:\n\n');
disp(real(J));
fprintf('\n\n          (Jsynt) Jacobian Matrix with automatic syntax correction:\n\n');
disp(real(Jaut));

fprintf('___________________________________________________________________________________\n\n');

fprintf('\n(iv) The final question: ');
fprintf('\n\n          ... J = Jaut?\n\n');
C = J == Jaut;
disp(C);

