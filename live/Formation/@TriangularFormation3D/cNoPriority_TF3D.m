%% Calculate kinematic control velocity

function cNoPriority_TF3D(obj)
% Direct transformation  X --> Q
obj.mDirTrans_TF3D;                   % get formation variables

% Formation pose error
obj.mFormationError_TF3D;

% Robot 1
x1 = obj.pPos.X(1);
y1 = obj.pPos.X(2);
z1 = obj.pPos.X(3);

% Robot 2
x2 = obj.pPos.X(4);
y2 = obj.pPos.X(5);
z2 = obj.pPos.X(6);

% Robot 3
x3 = obj.pPos.X(7);
y3 = obj.pPos.X(8);
z3 = obj.pPos.X(9);

%% Direct Jacobian Matrix (do not change it)

J = [                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    1/3,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      0,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      0,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         1/3,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           0,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           0,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         1/3,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           0,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           0
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      0,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    1/3,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      0,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           0,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         1/3,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           0,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           0,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         1/3,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           0;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      0,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      0,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    1/3,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           0,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           0,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         1/3,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           0,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           0,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         1/3;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              (x1 - x2)/((x1 - x2)^2 + (y1 - y2)^2 + (z1 - z2)^2)^(1/2),                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              (y1 - y2)/((x1 - x2)^2 + (y1 - y2)^2 + (z1 - z2)^2)^(1/2),                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              (z1 - z2)/((x1 - x2)^2 + (y1 - y2)^2 + (z1 - z2)^2)^(1/2),                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  -(x1 - x2)/((x1 - x2)^2 + (y1 - y2)^2 + (z1 - z2)^2)^(1/2),                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  -(y1 - y2)/((x1 - x2)^2 + (y1 - y2)^2 + (z1 - z2)^2)^(1/2),                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  -(z1 - z2)/((x1 - x2)^2 + (y1 - y2)^2 + (z1 - z2)^2)^(1/2),                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           0,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           0,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           0;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              (x1 - x3)/((x1 - x3)^2 + (y1 - y3)^2 + (z1 - z3)^2)^(1/2),                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              (y1 - y3)/((x1 - x3)^2 + (y1 - y3)^2 + (z1 - z3)^2)^(1/2),                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              (z1 - z3)/((x1 - x3)^2 + (y1 - y3)^2 + (z1 - z3)^2)^(1/2),                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           0,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           0,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           0,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  -(x1 - x3)/((x1 - x3)^2 + (y1 - y3)^2 + (z1 - z3)^2)^(1/2),                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  -(y1 - y3)/((x1 - x3)^2 + (y1 - y3)^2 + (z1 - z3)^2)^(1/2),                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  -(z1 - z3)/((x1 - x3)^2 + (y1 - y3)^2 + (z1 - z3)^2)^(1/2);
 ((2*x2 - 4*x1 + 2*x3)/(2*((x1 - x2)^2 + (y1 - y2)^2 + (z1 - z2)^2)^(1/2)*((x1 - x3)^2 + (y1 - y3)^2 + (z1 - z3)^2)^(1/2)) + ((2*x1 - 2*x2)*((x1 - x2)^2 + (x1 - x3)^2 - (x2 - x3)^2 + (y1 - y2)^2 + (y1 - y3)^2 - (y2 - y3)^2 + (z1 - z2)^2 + (z1 - z3)^2 - (z2 - z3)^2))/(4*((x1 - x2)^2 + (y1 - y2)^2 + (z1 - z2)^2)^(3/2)*((x1 - x3)^2 + (y1 - y3)^2 + (z1 - z3)^2)^(1/2)) + ((2*x1 - 2*x3)*((x1 - x2)^2 + (x1 - x3)^2 - (x2 - x3)^2 + (y1 - y2)^2 + (y1 - y3)^2 - (y2 - y3)^2 + (z1 - z2)^2 + (z1 - z3)^2 - (z2 - z3)^2))/(4*((x1 - x2)^2 + (y1 - y2)^2 + (z1 - z2)^2)^(1/2)*((x1 - x3)^2 + (y1 - y3)^2 + (z1 - z3)^2)^(3/2)))/(1 - ((x1 - x2)^2 + (x1 - x3)^2 - (x2 - x3)^2 + (y1 - y2)^2 + (y1 - y3)^2 - (y2 - y3)^2 + (z1 - z2)^2 + (z1 - z3)^2 - (z2 - z3)^2)^2/(4*((x1 - x2)^2 + (y1 - y2)^2 + (z1 - z2)^2)*((x1 - x3)^2 + (y1 - y3)^2 + (z1 - z3)^2)))^(1/2), ((2*y2 - 4*y1 + 2*y3)/(2*((x1 - x2)^2 + (y1 - y2)^2 + (z1 - z2)^2)^(1/2)*((x1 - x3)^2 + (y1 - y3)^2 + (z1 - z3)^2)^(1/2)) + ((2*y1 - 2*y2)*((x1 - x2)^2 + (x1 - x3)^2 - (x2 - x3)^2 + (y1 - y2)^2 + (y1 - y3)^2 - (y2 - y3)^2 + (z1 - z2)^2 + (z1 - z3)^2 - (z2 - z3)^2))/(4*((x1 - x2)^2 + (y1 - y2)^2 + (z1 - z2)^2)^(3/2)*((x1 - x3)^2 + (y1 - y3)^2 + (z1 - z3)^2)^(1/2)) + ((2*y1 - 2*y3)*((x1 - x2)^2 + (x1 - x3)^2 - (x2 - x3)^2 + (y1 - y2)^2 + (y1 - y3)^2 - (y2 - y3)^2 + (z1 - z2)^2 + (z1 - z3)^2 - (z2 - z3)^2))/(4*((x1 - x2)^2 + (y1 - y2)^2 + (z1 - z2)^2)^(1/2)*((x1 - x3)^2 + (y1 - y3)^2 + (z1 - z3)^2)^(3/2)))/(1 - ((x1 - x2)^2 + (x1 - x3)^2 - (x2 - x3)^2 + (y1 - y2)^2 + (y1 - y3)^2 - (y2 - y3)^2 + (z1 - z2)^2 + (z1 - z3)^2 - (z2 - z3)^2)^2/(4*((x1 - x2)^2 + (y1 - y2)^2 + (z1 - z2)^2)*((x1 - x3)^2 + (y1 - y3)^2 + (z1 - z3)^2)))^(1/2), ((2*z2 - 4*z1 + 2*z3)/(2*((x1 - x2)^2 + (y1 - y2)^2 + (z1 - z2)^2)^(1/2)*((x1 - x3)^2 + (y1 - y3)^2 + (z1 - z3)^2)^(1/2)) + ((2*z1 - 2*z2)*((x1 - x2)^2 + (x1 - x3)^2 - (x2 - x3)^2 + (y1 - y2)^2 + (y1 - y3)^2 - (y2 - y3)^2 + (z1 - z2)^2 + (z1 - z3)^2 - (z2 - z3)^2))/(4*((x1 - x2)^2 + (y1 - y2)^2 + (z1 - z2)^2)^(3/2)*((x1 - x3)^2 + (y1 - y3)^2 + (z1 - z3)^2)^(1/2)) + ((2*z1 - 2*z3)*((x1 - x2)^2 + (x1 - x3)^2 - (x2 - x3)^2 + (y1 - y2)^2 + (y1 - y3)^2 - (y2 - y3)^2 + (z1 - z2)^2 + (z1 - z3)^2 - (z2 - z3)^2))/(4*((x1 - x2)^2 + (y1 - y2)^2 + (z1 - z2)^2)^(1/2)*((x1 - x3)^2 + (y1 - y3)^2 + (z1 - z3)^2)^(3/2)))/(1 - ((x1 - x2)^2 + (x1 - x3)^2 - (x2 - x3)^2 + (y1 - y2)^2 + (y1 - y3)^2 - (y2 - y3)^2 + (z1 - z2)^2 + (z1 - z3)^2 - (z2 - z3)^2)^2/(4*((x1 - x2)^2 + (y1 - y2)^2 + (z1 - z2)^2)*((x1 - x3)^2 + (y1 - y3)^2 + (z1 - z3)^2)))^(1/2), ((2*x1 - 2*x3)/(2*((x1 - x2)^2 + (y1 - y2)^2 + (z1 - z2)^2)^(1/2)*((x1 - x3)^2 + (y1 - y3)^2 + (z1 - z3)^2)^(1/2)) - ((2*x1 - 2*x2)*((x1 - x2)^2 + (x1 - x3)^2 - (x2 - x3)^2 + (y1 - y2)^2 + (y1 - y3)^2 - (y2 - y3)^2 + (z1 - z2)^2 + (z1 - z3)^2 - (z2 - z3)^2))/(4*((x1 - x2)^2 + (y1 - y2)^2 + (z1 - z2)^2)^(3/2)*((x1 - x3)^2 + (y1 - y3)^2 + (z1 - z3)^2)^(1/2)))/(1 - ((x1 - x2)^2 + (x1 - x3)^2 - (x2 - x3)^2 + (y1 - y2)^2 + (y1 - y3)^2 - (y2 - y3)^2 + (z1 - z2)^2 + (z1 - z3)^2 - (z2 - z3)^2)^2/(4*((x1 - x2)^2 + (y1 - y2)^2 + (z1 - z2)^2)*((x1 - x3)^2 + (y1 - y3)^2 + (z1 - z3)^2)))^(1/2), ((2*y1 - 2*y3)/(2*((x1 - x2)^2 + (y1 - y2)^2 + (z1 - z2)^2)^(1/2)*((x1 - x3)^2 + (y1 - y3)^2 + (z1 - z3)^2)^(1/2)) - ((2*y1 - 2*y2)*((x1 - x2)^2 + (x1 - x3)^2 - (x2 - x3)^2 + (y1 - y2)^2 + (y1 - y3)^2 - (y2 - y3)^2 + (z1 - z2)^2 + (z1 - z3)^2 - (z2 - z3)^2))/(4*((x1 - x2)^2 + (y1 - y2)^2 + (z1 - z2)^2)^(3/2)*((x1 - x3)^2 + (y1 - y3)^2 + (z1 - z3)^2)^(1/2)))/(1 - ((x1 - x2)^2 + (x1 - x3)^2 - (x2 - x3)^2 + (y1 - y2)^2 + (y1 - y3)^2 - (y2 - y3)^2 + (z1 - z2)^2 + (z1 - z3)^2 - (z2 - z3)^2)^2/(4*((x1 - x2)^2 + (y1 - y2)^2 + (z1 - z2)^2)*((x1 - x3)^2 + (y1 - y3)^2 + (z1 - z3)^2)))^(1/2), ((2*z1 - 2*z3)/(2*((x1 - x2)^2 + (y1 - y2)^2 + (z1 - z2)^2)^(1/2)*((x1 - x3)^2 + (y1 - y3)^2 + (z1 - z3)^2)^(1/2)) - ((2*z1 - 2*z2)*((x1 - x2)^2 + (x1 - x3)^2 - (x2 - x3)^2 + (y1 - y2)^2 + (y1 - y3)^2 - (y2 - y3)^2 + (z1 - z2)^2 + (z1 - z3)^2 - (z2 - z3)^2))/(4*((x1 - x2)^2 + (y1 - y2)^2 + (z1 - z2)^2)^(3/2)*((x1 - x3)^2 + (y1 - y3)^2 + (z1 - z3)^2)^(1/2)))/(1 - ((x1 - x2)^2 + (x1 - x3)^2 - (x2 - x3)^2 + (y1 - y2)^2 + (y1 - y3)^2 - (y2 - y3)^2 + (z1 - z2)^2 + (z1 - z3)^2 - (z2 - z3)^2)^2/(4*((x1 - x2)^2 + (y1 - y2)^2 + (z1 - z2)^2)*((x1 - x3)^2 + (y1 - y3)^2 + (z1 - z3)^2)))^(1/2), ((2*x1 - 2*x2)/(2*((x1 - x2)^2 + (y1 - y2)^2 + (z1 - z2)^2)^(1/2)*((x1 - x3)^2 + (y1 - y3)^2 + (z1 - z3)^2)^(1/2)) - ((2*x1 - 2*x3)*((x1 - x2)^2 + (x1 - x3)^2 - (x2 - x3)^2 + (y1 - y2)^2 + (y1 - y3)^2 - (y2 - y3)^2 + (z1 - z2)^2 + (z1 - z3)^2 - (z2 - z3)^2))/(4*((x1 - x2)^2 + (y1 - y2)^2 + (z1 - z2)^2)^(1/2)*((x1 - x3)^2 + (y1 - y3)^2 + (z1 - z3)^2)^(3/2)))/(1 - ((x1 - x2)^2 + (x1 - x3)^2 - (x2 - x3)^2 + (y1 - y2)^2 + (y1 - y3)^2 - (y2 - y3)^2 + (z1 - z2)^2 + (z1 - z3)^2 - (z2 - z3)^2)^2/(4*((x1 - x2)^2 + (y1 - y2)^2 + (z1 - z2)^2)*((x1 - x3)^2 + (y1 - y3)^2 + (z1 - z3)^2)))^(1/2), ((2*y1 - 2*y2)/(2*((x1 - x2)^2 + (y1 - y2)^2 + (z1 - z2)^2)^(1/2)*((x1 - x3)^2 + (y1 - y3)^2 + (z1 - z3)^2)^(1/2)) - ((2*y1 - 2*y3)*((x1 - x2)^2 + (x1 - x3)^2 - (x2 - x3)^2 + (y1 - y2)^2 + (y1 - y3)^2 - (y2 - y3)^2 + (z1 - z2)^2 + (z1 - z3)^2 - (z2 - z3)^2))/(4*((x1 - x2)^2 + (y1 - y2)^2 + (z1 - z2)^2)^(1/2)*((x1 - x3)^2 + (y1 - y3)^2 + (z1 - z3)^2)^(3/2)))/(1 - ((x1 - x2)^2 + (x1 - x3)^2 - (x2 - x3)^2 + (y1 - y2)^2 + (y1 - y3)^2 - (y2 - y3)^2 + (z1 - z2)^2 + (z1 - z3)^2 - (z2 - z3)^2)^2/(4*((x1 - x2)^2 + (y1 - y2)^2 + (z1 - z2)^2)*((x1 - x3)^2 + (y1 - y3)^2 + (z1 - z3)^2)))^(1/2), ((2*z1 - 2*z2)/(2*((x1 - x2)^2 + (y1 - y2)^2 + (z1 - z2)^2)^(1/2)*((x1 - x3)^2 + (y1 - y3)^2 + (z1 - z3)^2)^(1/2)) - ((2*z1 - 2*z3)*((x1 - x2)^2 + (x1 - x3)^2 - (x2 - x3)^2 + (y1 - y2)^2 + (y1 - y3)^2 - (y2 - y3)^2 + (z1 - z2)^2 + (z1 - z3)^2 - (z2 - z3)^2))/(4*((x1 - x2)^2 + (y1 - y2)^2 + (z1 - z2)^2)^(1/2)*((x1 - x3)^2 + (y1 - y3)^2 + (z1 - z3)^2)^(3/2)))/(1 - ((x1 - x2)^2 + (x1 - x3)^2 - (x2 - x3)^2 + (y1 - y2)^2 + (y1 - y3)^2 - (y2 - y3)^2 + (z1 - z2)^2 + (z1 - z3)^2 - (z2 - z3)^2)^2/(4*((x1 - x2)^2 + (y1 - y2)^2 + (z1 - z2)^2)*((x1 - x3)^2 + (y1 - y3)^2 + (z1 - z3)^2)))^(1/2);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      0,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         (2*z2 - 4*z1 + 2*z3)/((y2 - 2*y1 + y3)^2 + (z2 - 2*z1 + z3)^2),                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        -(2*y2 - 4*y1 + 2*y3)/((y2 - 2*y1 + y3)^2 + (z2 - 2*z1 + z3)^2),                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           0,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 -(z2 - 2*z1 + z3)/((y2 - 2*y1 + y3)^2 + (z2 - 2*z1 + z3)^2),                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  (y2 - 2*y1 + y3)/((y2 - 2*y1 + y3)^2 + (z2 - 2*z1 + z3)^2),                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           0,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 -(z2 - 2*z1 + z3)/((y2 - 2*y1 + y3)^2 + (z2 - 2*z1 + z3)^2),                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  (y2 - 2*y1 + y3)/((y2 - 2*y1 + y3)^2 + (z2 - 2*z1 + z3)^2);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        -(2*z2 - 4*z1 + 2*z3)/((x2 - 2*x1 + x3)^2 + (z2 - 2*z1 + z3)^2),                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      0,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         (2*x2 - 4*x1 + 2*x3)/((x2 - 2*x1 + x3)^2 + (z2 - 2*z1 + z3)^2),                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  (z2 - 2*z1 + z3)/((x2 - 2*x1 + x3)^2 + (z2 - 2*z1 + z3)^2),                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           0,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 -(x2 - 2*x1 + x3)/((x2 - 2*x1 + x3)^2 + (z2 - 2*z1 + z3)^2),                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  (z2 - 2*z1 + z3)/((x2 - 2*x1 + x3)^2 + (z2 - 2*z1 + z3)^2),                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           0,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 -(x2 - 2*x1 + x3)/((x2 - 2*x1 + x3)^2 + (z2 - 2*z1 + z3)^2);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         (2*y2 - 4*y1 + 2*y3)/((x2 - 2*x1 + x3)^2 + (y2 - 2*y1 + y3)^2),                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        -(2*x2 - 4*x1 + 2*x3)/((x2 - 2*x1 + x3)^2 + (y2 - 2*y1 + y3)^2),                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      0,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 -(y2 - 2*y1 + y3)/((x2 - 2*x1 + x3)^2 + (y2 - 2*y1 + y3)^2),                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  (x2 - 2*x1 + x3)/((x2 - 2*x1 + x3)^2 + (y2 - 2*y1 + y3)^2),                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           0,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 -(y2 - 2*y1 + y3)/((x2 - 2*x1 + x3)^2 + (y2 - 2*y1 + y3)^2),                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  (x2 - 2*x1 + x3)/((x2 - 2*x1 + x3)^2 + (y2 - 2*y1 + y3)^2),                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           0];
 

%% Controller

% Formation reference velocity
obj.pPos.dQr = obj.pPos.dQd + obj.pPar.K1*tanh(obj.pPar.K2*obj.pPos.Qtil);

% Robots velocities 
try
    obj.pPos.dXr = pinv(J)*obj.pPos.dQr;
catch
end

obj.pPos.Xr = obj.pPos.Xr + obj.pPos.dXr*obj.pPar.Ts;

end